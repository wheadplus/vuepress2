# 执行环境及作用域

> `执行环境`（简称为`环境`）是JavaScript中的一个概念。执行环境定义了变量或函数有权访问的其他数据，决定它们各自的行为。每个执行环境都有一个与之相关联的`变量对象`，环境中定义的所有变量和函数都保存在这个对象中。虽然我们无法访问到该对象，但解析器在处理数据时会在后台使用它。
>
> 

全局执行环境是最外围的一个执行环境。在浏览器中，就是`window`对象。

每个函数都有自己的`执行环境`。当执行流进入一个函数时，函数的环境被推入一个环境栈中。函数执行后，栈将其环境弹出，把控制权返回给之前的执行环境。

##### 作用域链

当代码咋一个环境中执行，会创建·变量对象的一个作用域链。它的作用保证环境的所有变量和函数的有序访问。也就是全局环境执行，执行到函数时，进入下一层环境继续执行。如内部有函数，继续下层执行。每次函数执行后，返回之前的环境中。

```js
var color = 'green'
function changeColor() {
    if(color === 'green') {
        color = 'red'
    } else {
        color = 'blue'
    }
}
changeColor()
```

changeColor有的作用域链有两个对象，全局环境和它本身的环境。可以在函数内部访问到变量`color`，就是因为可以在这个作用域链中找到它。

## 总结

- 执行环境保存了它的变量和函数。
- 函数有它自己的执行环境。
- 函数执行的时候，先从内部环境找变量
- 如果找不到，通过作用域链在上层环境中寻找。